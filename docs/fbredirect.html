<!--
This page is used as the redirect page for SocialMiner Facebook Fan page OAuth authorization.  It needs to be visible on the public Internet
to server as the FB redirect page.
-->
<HTML>
<BODY>
<STYLE TYPE="text/css">
body{
  background-color: #4c7fa6;
  }
<!--
td {
  background-color: #FEEFB3;
  color: #000000;
  font-family: "Lucida Grande",Verdana,sans-serif;
  background-position: 10px center;
  background-repeat: no-repeat;
  border: 1px solid #9F6000;
  margin: 5px 0;
  padding: 5px;
  width: 100%;
  font-size: 12px;
  line-height: 16px;
}
-->
</STYLE>
<table id='msgTable' style="display:none"><td id='msg'></td></table>
<form id='myForm' name='myForm' action=''  method=POST>
</form>
<script>
// Parse out refurl from href
document.title = "Facebook Redirect Page";
var href=window.location.href;
var msg="Fan page authorization failed.  Return to SocialMiner and restart authorization process."
var callbackIndex=href.indexOf("?host_feedId=");
if(callbackIndex!=-1){
  var callback=unescape(href.substring(callbackIndex+1));
  callback = callback.split("host_feedId=")[1];
  callback = callback.split("&")[0];

  var codeIndex = href.indexOf("&code=");  
  if(codeIndex!=-1){
    var code = href.split("&code=")[1]; //get everything after code=   
    var tokenQueryParam = document.createElement('input');
    tokenQueryParam.type='hidden';
    tokenQueryParam.name='access_code';
    tokenQueryParam.value=code;
    document.myForm.appendChild(tokenQueryParam);
  }

  //if failure, pass the error description
  var errorIndex = href.indexOf("error_description")
  if(errorIndex!=-1){
    var error = href.substring(errorIndex);
    error = error.split("error_description=")[1];    

    var errorQueryParam = document.createElement('input');
    errorQueryParam.type='hidden';
    errorQueryParam.name='error_description';
    errorQueryParam.value=error;
    document.myForm.appendChild(errorQueryParam);
  
  }

  var str = callback.split("_");
  var host = str[0];
  var id = str[1];
  
  document.myForm.action = "https://"+host+"/ccp-webapp/ccp/feed/"+id+"/facebookCallback";
  document.myForm.submit();


}

</script>
<font color="white">Please wait...</font>
</BODY>
</HTML> 

